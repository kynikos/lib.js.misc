"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// Generated by CoffeeScript 2.7.0
// lib.cs.misc - Check the status of code repositories under a root directory.
// Copyright (C) 2016 Dario Giovannetti <dev@dariogiovannetti.net>
// This file is part of lib.cs.misc.
// lib.cs.misc is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
// lib.cs.misc is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
// You should have received a copy of the GNU General Public License
// along with lib.cs.misc.  If not, see <http://www.gnu.org/licenses/>.
var $, TableSettings, TableSettingsNoSpan, TableSettingsRowspan;
$ = require('jquery');
TableSettings = /*#__PURE__*/_createClass(function TableSettings(table) {
  _classCallCheck(this, TableSettings);

  var _hideSettings, self, _showSettings;

  this.table = table;
  self = this;

  _showSettings = function showSettings(event) {
    var form, settings;
    settings = $(this).closest('div.settings');
    form = settings.children('form');

    if (form.length) {
      form.show();
    } else {
      form = $('<form>').appendTo(settings);
      self.table.find('th').each(function (index) {
        var th;
        th = $(this);
        return form.append($('<label>').text(th.text()).prepend($('<input type="checkbox">').prop('checked', true).change(function () {
          if ($(this)[0].checked) {
            return self._showField(index);
          } else {
            return self._hideField(index);
          }
        }))).append('<br>');
      });
    }

    $(this).off('click', _showSettings).on('click', _hideSettings);
    return false;
  };

  _hideSettings = function hideSettings(event) {
    // Only hide the form, don't remove it, or the checkboxes will
    // have to be reinitialized to a checked/unchecked status based on
    // the visibility of each field every time the settings are shown
    // again
    $(this).closest('div.settings').children('form').hide();
    $(this).off('click', _hideSettings).on('click', _showSettings);
    return false;
  };

  $('<div>').addClass('settings').append($('<a>').attr('href', '#').text('Settings').click(_showSettings)).insertBefore(this.table);
});

TableSettingsNoSpan = /*#__PURE__*/function (_TableSettings) {
  _inherits(TableSettingsNoSpan, _TableSettings);

  var _super = _createSuper(TableSettingsNoSpan);

  function TableSettingsNoSpan() {
    _classCallCheck(this, TableSettingsNoSpan);

    return _super.apply(this, arguments);
  }

  _createClass(TableSettingsNoSpan, [{
    key: "_showField",
    value: function _showField(index) {
      var filter;
      filter = ':nth-of-type(' + (index + 1) + ')';
      return this.table.find('th' + filter + ', td' + filter).show();
    }
  }, {
    key: "_hideField",
    value: function _hideField(index) {
      var filter;
      filter = ':nth-of-type(' + (index + 1) + ')';
      return this.table.find('th' + filter + ', td' + filter).hide();
    }
  }]);

  return TableSettingsNoSpan;
}(TableSettings);

TableSettingsRowspan = /*#__PURE__*/function (_TableSettings2) {
  _inherits(TableSettingsRowspan, _TableSettings2);

  var _super2 = _createSuper(TableSettingsRowspan);

  function TableSettingsRowspan() {
    _classCallCheck(this, TableSettingsRowspan);

    return _super2.apply(this, arguments);
  }

  _createClass(TableSettingsRowspan, [{
    key: "_showField",
    value: function _showField(index) {
      return this.table.find('.col' + index).show();
    }
  }, {
    key: "_hideField",
    value: function _hideField(index) {
      return this.table.find('.col' + index).hide();
    }
  }]);

  return TableSettingsRowspan;
}(TableSettings);

module.exports.extjQuery = function ($) {
  $.fn.addTableSettings = function () {
    return this.each(function () {
      if ($(this).hasClass('hideable-fields-nospan')) {
        new TableSettingsNoSpan($(this));
      } else if ($(this).hasClass('hideable-fields-rowspan')) {
        new TableSettingsRowspan($(this));
      }

      return $(this);
    });
  };

  $.fn.prependTableDataRows = function () {
    for (var _len = arguments.length, rows = new Array(_len), _key = 0; _key < _len; _key++) {
      rows[_key] = arguments[_key];
    }

    return this.each(function () {
      var cell, i, j, len, len1, row, tr; // TODO: Check if this is a table, thead, tbody or tfoot?

      for (i = 0, len = rows.length; i < len; i++) {
        row = rows[i];
        tr = $('<tr>');

        for (j = 0, len1 = row.length; j < len1; j++) {
          cell = row[j];
          tr.append($('<td>').append(cell));
        }

        $(this).prepend(tr);
      }

      return $(this);
    });
  };

  return $.fn.appendTableDataRows = function () {
    for (var _len2 = arguments.length, rows = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      rows[_key2] = arguments[_key2];
    }

    return this.each(function () {
      var cell, i, j, len, len1, row, tr; // TODO: Check if this is a table, thead, tbody or tfoot?

      for (i = 0, len = rows.length; i < len; i++) {
        row = rows[i];
        tr = $('<tr>');

        for (j = 0, len1 = row.length; j < len1; j++) {
          cell = row[j];
          tr.append($('<td>').append(cell));
        }

        $(this).append(tr);
      }

      return $(this);
    });
  };
};